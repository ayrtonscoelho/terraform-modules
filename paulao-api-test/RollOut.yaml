apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: paulao-api-test
  namespace: paulao-api-test
  annotations:
    reloader.stakater.com/auto: "true"
  labels:
    app.kubernetes.io/name: paulao-api-test
spec:
  replicas: 4
  strategy:
    canary:
      steps:
      - setWeight: 20
      - pause: {duration: 60}
      - setWeight: 40
      - pause: {duration: 60}
      - setWeight: 60
      - pause: {duration: 60}
      - setWeight: 80
      - pause: {duration: 60}
  selector:
    matchLabels:
      app.kubernetes.io/name: paulao-api-test
  workloadRef: 
    apiVersion: apps/v1
    kind: Deployment
    name: paulao-api-test
    namespace: paulao-api-test
  # Minimum number of seconds for which a newly created pod should be ready
  # without any of its container crashing, for it to be considered available.
  # Defaults to 0 (pod will be considered available as soon as it is ready)
  minReadySeconds: 30

  # The number of old ReplicaSets to retain.
  # Defaults to 10
  revisionHistoryLimit: 3    